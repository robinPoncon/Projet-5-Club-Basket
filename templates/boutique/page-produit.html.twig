{% extends "base.html.twig" %}

{% block title %} Produit {{ produit.name }}{% endblock %}

{% block body %}

    <h1>Page produit "{{ produit.name }}"</h1>

    <div class="blocFicheProduit">
        {% if photoImportante.imageName is defined and photoImportante.imageName is not null %}
            <img alt="image du produit mise en avant" class="imageImportanteProduit"
                 src="{{ asset(vich_uploader_asset(photoImportante, "imageFile") |imagine_filter("equipeAffichage")) }}"
                 title="Cliquer pour aggrandire l'image">
            <img alt="image du produit mise en avant" class="imageImportanteFull"
                 src="{{ asset(vich_uploader_asset(photoImportante, "imageFile")) }}" title="Cliquer pour réduire l'image">
        {% endif %}
        <div class="d-flex vente">
            <div class="d-flex flex-column images">
                {% for photo in photoProduits %}
                <img src="{{ asset(vich_uploader_asset(photo, "imageFile") |imagine_filter("equipeAffichage")) }}"
                     alt="les autres images du produit" class="miniature">
                    <img src="{{ asset(vich_uploader_asset(photo, "imageFile")) }}"
                         alt="les autres images du produit" class="fullImage">
                {% endfor %}
            </div>
            <div class="ficheProduit">
                <h2>Prix - {{ produit.price }}€</h2>

                <div class="d-flex justify-content-center">
                    <h3>Couleurs disponibles : </h3>
                    <select class="form-control" name="listColors" id="selectColor">
                        {% for color in produit.colors %}
                            <option value="{{ color.id }}">{{ color.name }}</option>
                        {% endfor %}
                    </select>

                </div>
                <div class="d-flex justify-content-center">
                    <h3>Tailles disponibles pour cette couleur :</h3>
                    <select class="form-control" name="listTaille" id="selectTaille">

                    </select>
                </div>
                <div>
                    <h3>Quantité pour cette taille = <span class="quantityTaille"></span></h3>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block javascripts %}
    <script>
        function sendAjaxController(id)
        {
            $.ajax({
                method: "POST",
                url: "{{ path("ajax_colors") }}",
                data: {id: id},
                success: function (responses) {
                    //console.log(responses);
                    if (responses.length === 0)
                    {
                        let noColor = $("<option>", {
                            text: "Il n'y a plus de stock pour cette couleur."
                        });

                        $("#selectTaille").append(noColor);

                        $(".quantityTaille").text(0);
                    }
                    else
                    {
                        responses.forEach((datas) => {
                            //console.log(datas.horaire.timestamp);
                            htmlResponseAjaxTailleColors(datas.name, datas.quantity);
                        });
                    }
                }
            });
        }

        let valColor = $("#selectColor option:selected").val();
        sendAjaxController(valColor);

        $("#selectColor").change(function () {
            valColor = $("#selectColor option:selected").val();
            //console.log(valProduit);
            $("#selectTaille").text("");
            sendAjaxController(valColor);
        });

        $("#selectTaille").change(function(){
            valTaille = $("#selectTaille option:selected").val();
            showQuantityTaille(valTaille);
        });
    </script>
{% endblock %}